"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var Rx_1 = require("rxjs/Rx");
var kinvey_nativescript_sdk_1 = require("kinvey-nativescript-sdk");
var config_1 = require("../../shared/config");
var car_model_1 = require("./car.model");
var fs = require("file-system");
var editableProperties = [
    "class",
    "doors",
    "hasAC",
    "transmission",
    "luggage",
    "name",
    "price",
    "seats",
    "imageUrl"
];
var CarService = (function () {
    function CarService() {
        this.allCars = [];
        this.carsStore = kinvey_nativescript_sdk_1.Kinvey.DataStore.collection("cars");
    }
    CarService_1 = CarService;
    CarService.cloneUpdateModel = function (car) {
        // tslint:disable-next-line:ban-comma-operator
        return editableProperties.reduce(function (a, e) { return (a[e] = car[e], a); }, { _id: car.id });
    };
    CarService.prototype.getCarById = function (id) {
        if (!id) {
            return;
        }
        return this.allCars.filter(function (car) {
            return car.id === id;
        })[0];
    };
    CarService.prototype.load = function () {
        var _this = this;
        return new Rx_1.Observable(function (observer) {
            _this.login().then(function () {
                return _this.carsStore.sync();
            }).then(function () {
                var sortByNameQuery = new kinvey_nativescript_sdk_1.Kinvey.Query();
                sortByNameQuery.ascending("name");
                var stream = _this.carsStore.find(sortByNameQuery);
                return stream.toPromise();
            }).then(function (data) {
                _this.allCars = [];
                data.forEach(function (carData) {
                    carData.id = carData._id;
                    var car = new car_model_1.Car(carData);
                    _this.allCars.push(car);
                });
                observer.next(_this.allCars);
            }).catch(_this.handleErrors);
        });
    };
    CarService.prototype.update = function (carModel) {
        var updateModel = CarService_1.cloneUpdateModel(carModel);
        return this.carsStore.save(updateModel);
    };
    CarService.prototype.uploadImage = function (remoteFullPath, localFullPath) {
        var imageFile = fs.File.fromPath(localFullPath);
        var imageContent = imageFile.readSync();
        var metadata = {
            filename: imageFile.name,
            mimeType: this.getMimeType(imageFile.extension),
            size: imageContent.length,
            public: true
        };
        return kinvey_nativescript_sdk_1.Kinvey.Files.upload(imageFile, metadata, { timeout: 2147483647 })
            .then(function (uploadedFile) {
            var query = new kinvey_nativescript_sdk_1.Kinvey.Query();
            query.equalTo("_id", uploadedFile._id);
            return kinvey_nativescript_sdk_1.Kinvey.Files.find(query);
        })
            .then(function (files) {
            if (files && files.length) {
                var file = files[0];
                file.url = file._downloadURL;
                return file;
            }
            else {
                Promise.reject(new Error("No items with the given ID could be found."));
            }
        });
    };
    CarService.prototype.login = function () {
        if (!!kinvey_nativescript_sdk_1.Kinvey.User.getActiveUser()) {
            return Promise.resolve();
        }
        else {
            return kinvey_nativescript_sdk_1.Kinvey.User.login(config_1.Config.kinveyUsername, config_1.Config.kinveyPassword);
        }
    };
    CarService.prototype.handleErrors = function (error) {
        console.log(error);
        return Rx_1.Observable.throw(error);
    };
    CarService.prototype.getMimeType = function (imageExtension) {
        var extension = imageExtension === "jpg" ? "jpeg" : imageExtension;
        return "image/" + extension.replace(/\./g, "");
    };
    CarService = CarService_1 = __decorate([
        core_1.Injectable()
    ], CarService);
    return CarService;
    var CarService_1;
}());
exports.CarService = CarService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUEyQztBQUMzQyw4QkFBcUM7QUFFckMsbUVBQWlEO0FBQ2pELDhDQUE2QztBQUM3Qyx5Q0FBa0M7QUFFbEMsZ0NBQWtDO0FBRWxDLElBQU0sa0JBQWtCLEdBQUc7SUFDdkIsT0FBTztJQUNQLE9BQU87SUFDUCxPQUFPO0lBQ1AsY0FBYztJQUNkLFNBQVM7SUFDVCxNQUFNO0lBQ04sT0FBTztJQUNQLE9BQU87SUFDUCxVQUFVO0NBQ2IsQ0FBQztBQUdGO0lBREE7UUFPWSxZQUFPLEdBQWUsRUFBRSxDQUFDO1FBQ3pCLGNBQVMsR0FBRyxnQ0FBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQU0sTUFBTSxDQUFDLENBQUM7SUEyRmpFLENBQUM7bUJBbEdZLFVBQVU7SUFDSiwyQkFBZ0IsR0FBL0IsVUFBZ0MsR0FBUTtRQUNwQyw4Q0FBOEM7UUFDOUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQWxCLENBQWtCLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEYsQ0FBQztJQUtELCtCQUFVLEdBQVYsVUFBVyxFQUFVO1FBQ2pCLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNOLE1BQU0sQ0FBQztRQUNYLENBQUM7UUFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBQyxHQUFHO1lBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQyxDQUFD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XCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anMvUnhcIjtcblxuaW1wb3J0IHsgS2ludmV5IH0gZnJvbSBcImtpbnZleS1uYXRpdmVzY3JpcHQtc2RrXCI7XG5pbXBvcnQgeyBDb25maWcgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL2NvbmZpZ1wiO1xuaW1wb3J0IHsgQ2FyIH0gZnJvbSBcIi4vY2FyLm1vZGVsXCI7XG5cbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmaWxlLXN5c3RlbVwiO1xuXG5jb25zdCBlZGl0YWJsZVByb3BlcnRpZXMgPSBbXG4gICAgXCJjbGFzc1wiLFxuICAgIFwiZG9vcnNcIixcbiAgICBcImhhc0FDXCIsXG4gICAgXCJ0cmFuc21pc3Npb25cIixcbiAgICBcImx1Z2dhZ2VcIixcbiAgICBcIm5hbWVcIixcbiAgICBcInByaWNlXCIsXG4gICAgXCJzZWF0c1wiLFxuICAgIFwiaW1hZ2VVcmxcIlxuXTtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENhclNlcnZpY2Uge1xuICAgIHByaXZhdGUgc3RhdGljIGNsb25lVXBkYXRlTW9kZWwoY2FyOiBDYXIpOiBvYmplY3Qge1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6YmFuLWNvbW1hLW9wZXJhdG9yXG4gICAgICAgIHJldHVybiBlZGl0YWJsZVByb3BlcnRpZXMucmVkdWNlKChhLCBlKSA9PiAoYVtlXSA9IGNhcltlXSwgYSksIHsgX2lkOiBjYXIuaWQgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhbGxDYXJzOiBBcnJheTxDYXI+ID0gW107XG4gICAgcHJpdmF0ZSBjYXJzU3RvcmUgPSBLaW52ZXkuRGF0YVN0b3JlLmNvbGxlY3Rpb248YW55PihcImNhcnNcIik7XG5cbiAgICBnZXRDYXJCeUlkKGlkOiBzdHJpbmcpOiBDYXIge1xuICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5hbGxDYXJzLmZpbHRlcigoY2FyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2FyLmlkID09PSBpZDtcbiAgICAgICAgfSlbMF07XG4gICAgfVxuXG4gICAgbG9hZCgpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9naW4oKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYXJzU3RvcmUuc3luYygpO1xuICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc29ydEJ5TmFtZVF1ZXJ5ID0gbmV3IEtpbnZleS5RdWVyeSgpO1xuICAgICAgICAgICAgICAgIHNvcnRCeU5hbWVRdWVyeS5hc2NlbmRpbmcoXCJuYW1lXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuY2Fyc1N0b3JlLmZpbmQoc29ydEJ5TmFtZVF1ZXJ5KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBzdHJlYW0udG9Qcm9taXNlKCk7XG4gICAgICAgICAgICB9KS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGxDYXJzID0gW107XG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChjYXJEYXRhOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2FyRGF0YS5pZCA9IGNhckRhdGEuX2lkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYXIgPSBuZXcgQ2FyKGNhckRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWxsQ2Fycy5wdXNoKGNhcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KHRoaXMuYWxsQ2Fycyk7XG4gICAgICAgICAgICB9KS5jYXRjaCh0aGlzLmhhbmRsZUVycm9ycyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHVwZGF0ZShjYXJNb2RlbDogQ2FyKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgdXBkYXRlTW9kZWwgPSBDYXJTZXJ2aWNlLmNsb25lVXBkYXRlTW9kZWwoY2FyTW9kZWwpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmNhcnNTdG9yZS5zYXZlKHVwZGF0ZU1vZGVsKTtcbiAgICB9XG5cbiAgICB1cGxvYWRJbWFnZShyZW1vdGVGdWxsUGF0aDogc3RyaW5nLCBsb2NhbEZ1bGxQYXRoOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCBpbWFnZUZpbGUgPSBmcy5GaWxlLmZyb21QYXRoKGxvY2FsRnVsbFBhdGgpO1xuICAgICAgICBjb25zdCBpbWFnZUNvbnRlbnQgPSBpbWFnZUZpbGUucmVhZFN5bmMoKTtcblxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHtcbiAgICAgICAgICAgIGZpbGVuYW1lOiBpbWFnZUZpbGUubmFtZSxcbiAgICAgICAgICAgIG1pbWVUeXBlOiB0aGlzLmdldE1pbWVUeXBlKGltYWdlRmlsZS5leHRlbnNpb24pLFxuICAgICAgICAgICAgc2l6ZTogaW1hZ2VDb250ZW50Lmxlbmd0aCxcbiAgICAgICAgICAgIHB1YmxpYzogdHJ1ZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBLaW52ZXkuRmlsZXMudXBsb2FkKGltYWdlRmlsZSwgbWV0YWRhdGEsIHsgdGltZW91dDogMjE0NzQ4MzY0NyB9KVxuICAgICAgICAgICAgLnRoZW4oKHVwbG9hZGVkRmlsZTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBuZXcgS2ludmV5LlF1ZXJ5KCk7XG4gICAgICAgICAgICAgICAgcXVlcnkuZXF1YWxUbyhcIl9pZFwiLCB1cGxvYWRlZEZpbGUuX2lkKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBLaW52ZXkuRmlsZXMuZmluZChxdWVyeSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKGZpbGVzOiBBcnJheTxhbnk+KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIGZpbGUudXJsID0gZmlsZS5fZG93bmxvYWRVUkw7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiTm8gaXRlbXMgd2l0aCB0aGUgZ2l2ZW4gSUQgY291bGQgYmUgZm91bmQuXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGxvZ2luKCk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGlmICghIUtpbnZleS5Vc2VyLmdldEFjdGl2ZVVzZXIoKSkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIEtpbnZleS5Vc2VyLmxvZ2luKENvbmZpZy5raW52ZXlVc2VybmFtZSwgQ29uZmlnLmtpbnZleVBhc3N3b3JkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRXJyb3JzKGVycm9yOiBSZXNwb25zZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG5cbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyb3IpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TWltZVR5cGUoaW1hZ2VFeHRlbnNpb246IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGltYWdlRXh0ZW5zaW9uID09PSBcImpwZ1wiID8gXCJqcGVnXCIgOiBpbWFnZUV4dGVuc2lvbjtcblxuICAgICAgICByZXR1cm4gXCJpbWFnZS9cIiArIGV4dGVuc2lvbi5yZXBsYWNlKC9cXC4vZywgXCJcIik7XG4gICAgfVxufVxuIl19